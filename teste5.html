<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrollBar Class with Dynamic Height and Proportional Thumb</title>
    <style>
        .container {
            display: flex;
            width: 50vmin;
            margin: 5vmin;
        }

        /* Estilo do grid */
        .grid {
            width: 100%;
            border-collapse: collapse;
        }

        .grid th, .grid td {
            border: 0.1vmin solid #ddd;
            padding: 1vmin;
            text-align: left;
        }

        /* Estilo do track e thumb do scrollbar */
        .scroll-track {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #bbb;
            border-radius: 1.5vmin;
        }

        .scroll-thumb {
            position: absolute;
            width: 100%;
            background-color: blue;
            cursor: grab; /* Mostra a mão aberta para arrastar */
            border-radius: 1.5vmin;
            min-height: 3vmin; /* Define uma altura mínima para o thumb */
        }

        .scroll-thumb:active {
            cursor: grabbing; /* Muda para a mão fechada enquanto arrasta */
        }

        /* A altura do scrollbar será sincronizada com o container */
        .scroll-container {
            width: 3vmin;
            height: auto; /* Altura dinâmica */
            margin-left: 1vmin;
        }

        /* Ajuste a altura para suportar 10 linhas visíveis */
        .table-container {
            height: auto;
            overflow: hidden; /* Sem rolagem interna */
        }
    </style>
</head>
<body>

    <h2>ScrollBar Class with Dynamic Height and Proportional Thumb</h2>

    <div class="container">
        <!-- Container da tabela -->
        <div class="table-container" id="table-container">
            <table class="grid" id="my-grid">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody id="grid-body">
                    <!-- Inicialmente vazio, será preenchido com os dados da consulta -->
                </tbody>
            </table>
        </div>

        <!-- Container do ScrollBar -->
        <div id="scrollbar-container" class="scroll-container">
            <div class="scroll-track">
                <div class="scroll-thumb"></div>
            </div>
        </div>
    </div>

    <script>
        // Simulação de consulta SQL que retorna dados paginados
        function fetchDataForPage(page, rowsPerPage) {
            // Simula uma consulta SQL, retornando o número de linhas por página
            const data = [];
            for (let i = (page - 1) * rowsPerPage + 1; i <= page * rowsPerPage; i++) {
                data.push({ id: i, name: `Item ${i}` });
            }
            return data;
        }

        // Função para montar o grid com base nos dados retornados da consulta
        function updateGridWithData(data) {
            const gridBody = document.getElementById('grid-body');
            gridBody.innerHTML = ''; // Limpa o grid antes de atualizar

            data.forEach(row => {
                const newRow = `<tr><td>${row.id}</td><td>${row.name}</td></tr>`;
                gridBody.innerHTML += newRow;
            });
        }

        class ScrollBar {
            constructor(scrollbarElement, gridElement, totalPages, rowsPerPage) {
                this.scrollbar = scrollbarElement.querySelector('.scroll-thumb');
                this.scrollTrack = scrollbarElement.querySelector('.scroll-track');
                this.grid = gridElement;
                this.isDragging = false;
                this.currentPage = 1; // Página atual
                this.totalPages = totalPages; // Total de páginas
                this.rowsPerPage = rowsPerPage; // Quantidade de linhas por página

                this.initializeEvents();
                this.loadPageData(); // Carrega a primeira página
				this.syncHeightWithContainer();
            }

            // Sincroniza a altura do ScrollBar com o container da tabela
            syncHeightWithContainer() {
				const headerHeight = this.grid.querySelector('thead').offsetHeight; // Altura do cabeçalho
				const rowHeight = this.grid.querySelector('tbody tr').offsetHeight; // Altura de uma linha de dados
				const containerHeight = headerHeight + (rowHeight * this.rowsPerPage); // Altura total do contêiner

				this.grid.parentElement.style.height = `${containerHeight}px`; // Define a altura do container da tabela
				this.scrollTrack.style.height = `${containerHeight}px`; // Define a altura do scroll-track

                // Ajusta a altura do thumb proporcionalmente ao número de páginas
                const thumbHeight = Math.max((this.rowsPerPage / (this.totalPages * this.rowsPerPage)) * containerHeight, 10);
                this.scrollbar.style.height = `${thumbHeight}px`; // Define a altura do thumb
            }

            // Carrega os dados da página atual e atualiza o grid
            loadPageData() {
                const data = fetchDataForPage(this.currentPage, this.rowsPerPage);
                updateGridWithData(data);
            }

            // Inicializa os eventos para o scroll
            initializeEvents() {
                // Evento de arrastar o thumb
                this.scrollbar.addEventListener('mousedown', () => {
                    this.isDragging = true;
                    document.body.style.userSelect = 'none'; // Evita seleção de texto ao arrastar
                });

                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        const trackRect = this.scrollTrack.getBoundingClientRect();
                        let newTop = e.clientY - trackRect.top - this.scrollbar.offsetHeight / 2;
                        this.updateScrollbarPosition(newTop);
                    }
                });

                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                    document.body.style.userSelect = 'auto';
                });

                // Evento para rolar com o mouse
                this.scrollTrack.addEventListener('wheel', (e) => {
                    const delta = e.deltaY; // Obtém a direção da rolagem (positiva ou negativa)
                    let currentTop = parseInt(this.scrollbar.style.top) || 0;

                    // Ajusta a posição do thumb com base na rolagem do mouse
                    let newTop = currentTop + delta * 0.2; // Ajusta a velocidade de rolagem
                    this.updateScrollbarPosition(newTop);
                });
            }

            // Função para atualizar a posição do thumb e mudar de página
            updateScrollbarPosition(newTop) {
                const trackRect = this.scrollTrack.getBoundingClientRect();

                // Limita o movimento dentro da trilha
                if (newTop < 0) newTop = 0;
                if (newTop > trackRect.height - this.scrollbar.offsetHeight) newTop = trackRect.height - this.scrollbar.offsetHeight;

                this.scrollbar.style.top = `${newTop}px`;

                // Calcula a página atual com base na posição do thumb
                const scrollPercentage = newTop / (trackRect.height - this.scrollbar.offsetHeight);
                this.currentPage = Math.round(scrollPercentage * (this.totalPages - 1)) + 1;

                // Carrega os dados da nova página
                this.loadPageData();
            }
        }

        // Inicialização da classe ScrollBar
        document.addEventListener('DOMContentLoaded', () => {
            const gridElement = document.getElementById('my-grid');
            const scrollbarElement = document.getElementById('scrollbar-container');
            const totalPages = 50; // Exemplo: 50 páginas

            // Instancia a classe ScrollBar
            new ScrollBar(scrollbarElement, gridElement, totalPages, 10);
        });
    </script>

</body>
</html>
