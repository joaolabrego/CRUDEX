<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dropdown com Paginação e Filtro</title>
  </head>
  <body>
    <script>
      class TDropdown extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({ mode: "open" });

          this.page = 1;
          this.optionsPerPage =
            parseInt(this.getAttribute("options-per-page")) || 5;
          this.options = [
            { id: 1, name: "Apple" },
            { id: 2, name: "Banana" },
            { id: 3, name: "Cherry" },
            { id: 4, name: "Date" },
            { id: 5, name: "Elderberry" },
            { id: 6, name: "Fig" },
            { id: 7, name: "Grape" },
            { id: 8, name: "Honeydew" },
            { id: 9, name: "Kiwi" },
            { id: 10, name: "Lemon" },
            { id: 11, name: "Mango" },
            { id: 12, name: "Nectarine" },
            { id: 13, name: "Orange" },
            { id: 14, name: "Papaya" },
            { id: 15, name: "Quince" },
            { id: 16, name: "Raspberry" },
            { id: 17, name: "Strawberry" },
            { id: 18, name: "Tomato" },
            { id: 19, name: "Ugli Fruit" },
            { id: 20, name: "Watermelon" },
          ];
          this.filterQuery = "";

          // Definição do HTML e CSS
          const style = document.createElement("style");
          style.textContent = `
                    .dropdown-container {
                        position: relative;
                        display: inline-block;
                    }
                    .dropdown-input {
                        padding-right: 20px; /* Espaço para a seta */
                    }
                    .dropdown-arrow {
                        position: absolute;
                        top: 50%;
                        right: 8px;
                        transform: translateY(-50%);
                        font-size: 12px;
                        color: #333;
                        cursor: pointer; /* Indicador de que a seta é clicável */
                    }						
                    .dropdown-options {
                        display: none;
                        position: absolute;
                        width: 100%;
                        max-height: 300px; /* Altura máxima para rolagem */
                        overflow-y: auto;
                    }
                    .dropdown-option {
                        padding: 2px;
                        cursor: pointer;
                    }
                    .dropdown-option:hover {
                        background-color: #f0f0f0;
                    }
                    .pagination-buttons {
                        display: flex;
                        justify-content: space-between;
                        padding: 2px;
                        background-color: #f9f9f9;
                    }
                    .pagination-button {
                        font-size: 0.9rem;
                        padding: 2px 4px;
                        cursor: pointer;
                        border: none;
                        background: none;
                        color: blue;
                    }
                    .pagination-button:disabled {
                        color: grey;
                        cursor: not-allowed;
                    }
                `;

          const container = document.createElement("div");
          container.classList.add("dropdown-container");

          this.input = document.createElement("input");
          this.input.classList.add("dropdown-input");
          this.input.setAttribute("type", "text");
          this.input.setAttribute("placeholder", "Digite ou selecione...");
          this.input.addEventListener("focusout", (event) => {
            if (!this.contains(event.relatedTarget))
              this.optionsDiv.style.display = "none";
          });
          this.input.addEventListener("focus", (event) => {
            if (event.target.value != "") {
              this.showOptions();
            }
          });
          this.input.addEventListener("input", () => this.applyFilter());
          container.appendChild(this.input);

          this.arrowIcon = document.createElement("span");
          this.arrowIcon.classList.add("dropdown-arrow");
          this.arrowIcon.textContent = "▼";
          this.arrowIcon.onclick = (event) => {
            if (this.optionsDiv.style.display === "block")
              this.optionsDiv.style.display = "none";
            else this.showOptions();
          };
          container.appendChild(this.arrowIcon);

          this.optionsDiv = document.createElement("div");
          this.optionsDiv.classList.add("dropdown-options");
          container.appendChild(this.optionsDiv);

          this.shadowRoot.appendChild(style);
          this.shadowRoot.appendChild(container);
        }

        connectedCallback() {
          // Evento no input apenas para aplicar filtro, sem abrir a lista

          this.prevPageButton = document.createElement("button");
          this.prevPageButton.textContent = "◀";
          this.prevPageButton.classList.add("pagination-button");
          this.prevPageButton.disabled = true;
          this.prevPageButton.addEventListener("click", () =>
            this.changePage(-1)
          );

          this.nextPageButton = document.createElement("button");
          this.nextPageButton.textContent = "▶";
          this.nextPageButton.classList.add("pagination-button");
          this.nextPageButton.addEventListener("click", () =>
            this.changePage(1)
          );

          this.paginationDiv = document.createElement("div");
          this.paginationDiv.classList.add("pagination-buttons");
          this.paginationDiv.appendChild(this.prevPageButton);
          this.paginationDiv.appendChild(this.nextPageButton);
        }

        showOptions() {
          this.loadOptions();
          this.positionOptions();
        }

        loadOptions() {
          this.optionsDiv.innerHTML = "";
          const filteredOptions = this.options.filter((option) =>
            option.name.toLowerCase().includes(this.filterQuery.toLowerCase())
          );

          const start = (this.page - 1) * this.optionsPerPage;
          const end = start + this.optionsPerPage;
          const pageOptions = filteredOptions.slice(start, end);

          pageOptions.forEach((option) => {
            const optionDiv = document.createElement("div");
            optionDiv.textContent = option.name;
            optionDiv.classList.add("dropdown-option");
            optionDiv.dataset.id = option.id;
            optionDiv.addEventListener("click", () => {
              this.input.value = this.filterQuery = option.name;
              this.input.dataset.id = option.id;
              this.optionsDiv.style.display = "none";
            });
            this.optionsDiv.appendChild(optionDiv);
          });
          this.optionsDiv.appendChild(this.paginationDiv);
          this.optionsDiv.style.display = "block";
          if (filteredOptions.length > this.optionsPerPage) {
            this.prevPageButton.style.display =
              this.nextPageButton.style.display = "initial";
            this.prevPageButton.disabled = this.page === 1;
            this.nextPageButton.disabled = end >= filteredOptions.length;
          } else
            this.prevPageButton.style.display =
              this.nextPageButton.style.display = "none";
        }

        positionOptions() {
          const rect = this.input.getBoundingClientRect();
          const dropdownHeight = 200; // Altura máxima do dropdown
          const spaceBelow = window.innerHeight - rect.bottom;
          const spaceAbove = rect.top;

          if (spaceBelow < dropdownHeight && spaceAbove > dropdownHeight) {
            this.optionsDiv.style.top = "auto";
            this.optionsDiv.style.bottom = "100%";
            this.optionsDiv.style.maxHeight = `${dropdownHeight}px`;
          } else {
            this.optionsDiv.style.top = "100%";
            this.optionsDiv.style.bottom = "auto";
            this.optionsDiv.style.maxHeight = `${dropdownHeight}px`;
          }
        }

        applyFilter() {
          this.filterQuery = this.input.value;
          this.page = 1;
          this.loadOptions();
        }

        changePage(direction) {
          this.page += direction;
          this.loadOptions();
        }
      }

      customElements.define("paginated-dropdown", TDropdown);

      // Adiciona o elemento paginated-dropdown programaticamente
      const dropdownElement = document.createElement("paginated-dropdown");
      document.body.appendChild(dropdownElement);
    </script>
  </body>
</html>
